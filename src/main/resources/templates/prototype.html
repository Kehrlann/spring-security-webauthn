<html>
<head><title>Passkeys</title></head>
<script id="script" type="text/javascript" th:data-credential-id="${credentialId}" th:data-challenge="${challenge}">
  const data = document.getElementById("script").dataset
  if (!window.PublicKeyCredential) { /* Client not capable. Handle error. */ }

  // credentialId is generated by the authenticator and is an opaque random byte array
  var credentialId = Uint8Array.from(window.atob(data.credentialId), c=>c.charCodeAt(0))
  var options = {
    rp: {
      name: "ACME Corporation"
    },
    // User:
    user: {
      id: Uint8Array.from(window.atob("MIIBkzCCATigAwIBAjCCAZMwggE4oAMCAQIwggGTMII="), c=>c.charCodeAt(0)),
      name: "alex.mueller@example.com",
      displayName: "Alex MÃ¼ller",
    },



    // The challenge is produced by the server; see the Security Considerations
    challenge: Uint8Array.from(window.atob(data.challenge), c=>c.charCodeAt(0)),
    timeout: 300000,  // 5 minutes
    allowCredentials: [{ type: "public-key", id: credentialId }],
    pubKeyCredParams: [
      {
        type: "public-key",
        alg: -7 // "ES256" as registered in the IANA COSE Algorithms registry
      },
      {
        type: "public-key",
        alg: -257 // Value registered by this specification for "RS256"
      }
    ],
  };

  console.log('fix')
  function create() {
    // Note: The following call will cause the authenticator to display UI.
    navigator.credentials.create({"publicKey": options } )
      .then(function (newCredentialInfo) {
        console.log(newCredentialInfo.response.toJson())
      }).catch(function (err) {
        console.log(`Error ${err}`)
      // No acceptable authenticator or user refused consent. Handle appropriately.
    });
  }
</script>
<body>
<button onclick="create()">Create</button>
</body>
</html>